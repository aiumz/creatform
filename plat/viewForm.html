<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>创建表单</title>
    <!--<link href="../plugin/bootstrap-3.3.5-dist/css/bootstrap.min.css"/>-->
    <link href="../plugin/bootstrap-3.3.5-dist/css/bootstrap.css" rel="stylesheet"/>
    <link href="../plugin/My97DatePicker/skin/WdatePicker.css" rel="stylesheet"/>
    <link href="../theme/style.css" rel="stylesheet"/>
    <link href="../theme/view-form.css" rel="stylesheet"/>
    <link href="../theme/colpick.css" rel="stylesheet"/>

</head>
<body>
<div class="fp-operate">
    <div class="fp-operateBtn">
        <a class="btn btn-default btn-sm pull-left" href="index.html" style="margin-top: 3px">返回列表</a>
        <a class="btn btn-default btn-sm pull-right" href="editForm.html" style="margin-top: 3px">编辑表单</a>
    </div>
</div>
<div class="f-wrapper fs-wrapper">
    <div class="fs-main view-form">
        <div class="f-header">
          
        </div>
        <div class="f-body">

        </div>
        <div class="f-footer">
            <a class="f_pageBtn f_pagePrev fs_submitBtn"> 上一页 </a>
            <a class="f_pageBtn f_pageNext fs_submitBtn "> 下一页 </a>
            <a class="no-submit">预览模式下不能提交</a>
        </div>
    </div>
</div>
<script src="../js/jquery.min.js"></script>
<script src="../js/style.js"></script>
<script src="../js/view-form.js"></script>
<script src="../js/colpick.js"></script>
<script src="../plugin/My97DatePicker/WdatePicker.js"></script>
<script src="../plugin/My97DatePicker/lang/zh-cn.js"></script>
<script src="../plugin/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>
</body>
<script>
/***************************************数据整理提交 start *****************************************/
(function(argument) {
                   // body...
            
               var supportType=["image/jpeg"]
               $('#choseFile').on("click",function() {
                    $(this).next("input").trigger("click")
               })
               $('#choseFile+input').on("change",function() {
                    var file=$(this)[0].files[0];
                    var type=file.type;
                    var name=file.name;
                    var hasSupport=false;
                    for(var i in supportType){
                        var reg=new  RegExp(supportType[i])
                        if(reg.test(type)){
                            hasSupport=true;
                        }
                    }
                    if(hasSupport){
                         $("#choseFile").prev('p').html(name)
                         post(file)
                     }else{
                        alert("文件格式不支持！")
                     }
                })
                function post(file){
                    var oMyForm = new FormData();
                    oMyForm.append("file",file)
                    $.ajax({
                          url: "./upload",
                          type: "POST",
                          data: oMyForm,
                          processData: false,  // 告诉jQuery不要去处理发送的数据
                          contentType: false,   // 告诉jQuery不要去设置Content-Type请求头
                          success:function(_res){
                               alert("OK")
                        }
                    });
                }
}());
/*    var oldIndex=0;
    $(".pingfenimg").on("click",function(argument) {
        var index=$(this).index('.pingfenimg')
        oldIndex=index;
       $(".pingfenimg").find('span:eq(0)').hide()
       $(".pingfenimg").find('span:eq(1)').show()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(1)').hide()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(0)').show()
    }) 
    $(".pingfenimg").on("mouseenter",function(argument) {
        var index=$(this).index('.pingfenimg')
       $(".pingfenimg").find('span:eq(0)').hide()
       $(".pingfenimg").find('span:eq(1)').show()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(1)').hide()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(0)').show()
    })    
    $(".pingfenimg").on("mouseleave",function(argument) {
        var index=oldIndex
       $(".pingfenimg").find('span:eq(0)').hide()
       $(".pingfenimg").find('span:eq(1)').show()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(1)').hide()
       $(".pingfenimg:lt("+(index+1)+")").find('span:eq(0)').show()
    })*/

 ;(function(argument) {
    $view={
      viewType:1, //1是预览 2 是发布
      html:"",
      page:[],
      init:function() {
         var _this=this;
         var viewType=_this.getQueryString("viewType");
         if(viewType==1){
            this.viewType=1;
            $.post("http://120.76.138.42:8099/form.php/index/getform/id/3",function (data) {
              _this.html=$("<div>"+decodeURI(data.html)+"</div>")
              //_this.html="<div>"+decodeURI(data.html)+"</div>"
              _this.viewManager()
            })
         }else{
            this.viewType=2;
           /* _this.html=data.html
              _this.viewManager()*/
         }
      },
     getQueryString:function (name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
      },  
      viewManager:function(argument) {
        var _this=this;
          var len=this.html.find("[type=pageTurning]").length+1;
          for(var i=0;i<len;i++){
            this.page.push($("<div page="+i+"></div>"))
          }
          var pageIndex=0;
          this.html.find(".like_li").each(function(index,value) {
            if($(value).attr("type")=="pageTurning"){
              pageIndex++;
            }else{
              _this.page[pageIndex].append($(value))
            }
        })
        for(var i in this.page){
          $(".f-body").append(this.page[i])
        }
      },

    }
   /* function oPublish(argument) {
      // body...
    }
    function oView(argument) {
      // body...
    }
    $.post("http://120.76.138.42:8099/form.php/index/getform/id/3",function (data) {

    })*/

 })();
 $view.init()
    </script>
</html>